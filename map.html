<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ржирж┐ржХржЯрж╕рзНрже рж╕рзНржмрж╛рж╕рзНржерзНржп ржХрзЗржирзНржжрзНрж░ ржорж╛ржиржЪрж┐рждрзНрж░</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Bengali:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="map.css"/>
</head>
<body>
  <header>ЁЯУН ржирж┐ржХржЯрж╕рзНрже рж╕рзНржмрж╛рж╕рзНржерзНржп ржХрзЗржирзНржжрзНрж░</header>
  <div id="main">
    <div id="sidebar">
      <div class="section">
        <h2>ржЖржкржирж╛рж░ ржЕржмрж╕рзНржерж╛ржи</h2>
        <button id="locateBtn">ЁЯУН ржЖржорж╛рж░ ржЕржмрж╕рзНржерж╛ржи ржЦрзБржБржЬрзБржи</button>
        <p id="status" style="font-size:13px;color:#555;">ржЕржмрж╕рзНржерж╛ржи ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рж╛ рж╣рзЯржирж┐</p>
      </div>

      <div class="section">
        <h2>рж╕рж╛рж░рзНржЪ ржХрж░рзБржи</h2>
        <input type="text" id="searchInput" placeholder="ржпрзЗржоржи: ржХрзНрж▓рж┐ржирж┐ржХ, ржлрж╛рж░рзНржорзЗрж╕рж┐, рж╣рж╛рж╕ржкрж╛рждрж╛рж▓">
        <select id="radius">
          <option value="1000">рзз ржХрж┐ржорж┐</option>
          <option value="3000" selected>рзй ржХрж┐ржорж┐</option>
          <option value="5000">рзл ржХрж┐ржорж┐</option>
          <option value="10000">рззрзж ржХрж┐ржорж┐</option>
        </select>
        <button id="searchBtn">ЁЯФН ржЦрзБржБржЬрзБржи</button>
      </div>

      <div class="section">
        <h2>ржлрж▓рж╛ржлрж▓</h2>
        <div id="results"></div>
      </div>
    </div>
    <div id="map"></div>
  </div>
  <footer>ржбрзЗржЯрж╛: OpenStreetMap | ржЙржирзНржирзЯржи: ржХржорж┐ржЙржирж┐ржЯрж┐ рж╣рзЗрж▓рже ржкрзНрж░рзЛржЯрзЛржЯрж╛ржЗржк</footer>

  <script>
    let map = L.map('map').setView([23.8103, 90.4125], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: '┬й OpenStreetMap contributors'
    }).addTo(map);

    let markers = L.layerGroup().addTo(map);
    let userLocation = null;

    document.getElementById('locateBtn').addEventListener('click', () => {
      if (navigator.geolocation) {
        document.getElementById('status').textContent = 'ржЕржмрж╕рзНржерж╛ржи ржкрж╛ржУрзЯрж╛ ржпрж╛ржЪрзНржЫрзЗ...';
        navigator.geolocation.getCurrentPosition(pos => {
          userLocation = [pos.coords.latitude, pos.coords.longitude];
          map.setView(userLocation, 15);
          L.marker(userLocation).addTo(map).bindPopup('ржЖржкржирж╛рж░ ржмрж░рзНрждржорж╛ржи ржЕржмрж╕рзНржерж╛ржи').openPopup();
          document.getElementById('status').textContent = 'ржЕржмрж╕рзНржерж╛ржи ржкрж╛ржУрзЯрж╛ ржЧрзЗржЫрзЗ тЬЕ';
        }, () => {
          document.getElementById('status').textContent = 'ржЕржмрж╕рзНржерж╛ржи ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐ тЭМ';
        });
      } else {
        alert('ржЖржкржирж╛рж░ ржмрзНрж░рж╛ржЙржЬрж╛рж░рзЗ рж▓рзЛржХрзЗрж╢ржи рж╕рж╛ржкрзЛрж░рзНржЯ ржХрж░рзЗ ржирж╛');
      }
    });

    document.getElementById('searchBtn').addEventListener('click', async () => {
      const query = document.getElementById('searchInput').value.trim();
      const radius = document.getElementById('radius').value;
      if (!query) return alert('рж╕рж╛рж░рзНржЪ ржХрж░рж╛рж░ ржЬржирзНржп ржирж╛ржо рж▓рж┐ржЦрзБржи');

      const center = userLocation || [23.8103, 90.4125];
      const url = `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}&limit=15&viewbox=${center[1]-0.1},${center[0]+0.1},${center[1]+0.1},${center[0]-0.1}&bounded=1`;

      document.getElementById('results').innerHTML = '<p>рж╕рж╛рж░рзНржЪ ржЪрж▓ржЫрзЗ...</p>';
      const res = await fetch(url);
      const data = await res.json();

      markers.clearLayers();
      document.getElementById('results').innerHTML = '';

      if (data.length === 0) {
        document.getElementById('results').innerHTML = '<p>ржХрзЛржирзЛ ржлрж▓рж╛ржлрж▓ ржкрж╛ржУрзЯрж╛ ржпрж╛рзЯржирж┐</p>';
        return;
      }

      data.forEach(place => {
        const lat = parseFloat(place.lat);
        const lon = parseFloat(place.lon);
        const name = place.display_name.split(',')[0];
        const marker = L.marker([lat, lon]).addTo(markers).bindPopup(`<strong>${name}</strong><br>${place.display_name}`);

        const div = document.createElement('div');
        div.className = 'result';
        div.innerHTML = `<strong>${name}</strong><small>${place.display_name}</small><br><button onclick="map.setView([${lat}, ${lon}], 16)">ЁЯУН ржжрзЗржЦрзБржи</button>`;
        document.getElementById('results').appendChild(div);
      });
    });
  </script>
</body>
</html>